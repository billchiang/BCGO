# AFP Conversion Module

## Purpose

This module is responsible for converting Advanced Function Presentation (AFP) documents to other formats, primarily:

*   PDF (Portable Document Format)
*   PDF/A (PDF for Archiving)
*   PCL (Printer Command Language)
*   PostScript (PS)

The module is designed to act as a microservice or a component within a larger document processing system.

## Core Conversion Technology

**This module itself does not implement the low-level AFP conversion logic.** Instead, it is designed to integrate with and wrap a specialized third-party conversion tool. This tool can be a commercial product or a suitable open-source library/tool if one that meets the required fidelity and MO:DCA IS/3 feature support is identified.

The choice of the underlying conversion tool is critical and should be based on the specific requirements for AFP feature support (e.g., fonts, overlays, IOCA images, FS45 color) and target format fidelity, as outlined in the main `AFP_Conversion_Module_Design.md` document.

## General Integration Approach

The integration with the chosen conversion tool can be achieved through one of the following methods:

1.  **Command-Line Interface (CLI) Wrapping:**
    *   The service will construct and execute command-line calls to the external conversion tool.
    *   Output files generated by the tool will be picked up by the service.
    *   Error handling will involve parsing the tool's exit codes and standard error/output streams.
    *   The `scripts/run_conversion_tool.sh.example` script illustrates this approach. The `AfpConversionService.java` is set up to call this script for PDF conversion.

2.  **Software Development Kit (SDK) Usage:**
    *   If the chosen conversion tool provides a Java SDK (or SDK for another language if the module is implemented differently), the service will use this SDK to perform conversions.
    *   This approach is generally more robust and provides better control and error handling than CLI wrapping.

## Key Configuration Points

The module will require configuration for its operation, typically managed via an `application.properties` file or environment variables. Key configuration items include:

*   **Conversion Tool Path:**
    *   `afp.conversion.tool.executable.path`: Absolute path to the conversion tool's executable (if using CLI). The current example in `AfpConversionService.java` uses a relative path `scripts/run_conversion_tool.sh.example`.
*   **License Information (if applicable for commercial tools).**
*   **AFP Resource Directories (font paths, overlay paths, etc.).**
*   **Temporary File Storage.**

See `src/main/java/com/example/afpconversion/config/application.properties.example` for more details.

## Running the Demonstration

The `AfpConversionService.java` class contains a `main` method that demonstrates the AFP to PDF conversion using the dummy `scripts/run_conversion_tool.sh.example` script.

**Prerequisites:**
1.  Ensure the script `scripts/run_conversion_tool.sh.example` is executable:
    ```bash
    chmod +x scripts/run_conversion_tool.sh.example
    ```
2.  The `main` method in `AfpConversionService.java` expects an input AFP file. It attempts to create a dummy input file at `../AFPGenerationModule/output/statement.afp` relative to the `AFP_Conversion_Module_Design` project root if it doesn't find one. For a more realistic test, you can place an actual (or the generated) AFP file there.

**Steps to Run:**

1.  **Compile the module (if not already done):**
    Although the `AfpConversionService` doesn't have external Maven dependencies for its core ProcessBuilder logic, if it were part of a larger Spring Boot application (as hinted by `@Service`), you'd build it using Maven:
    ```bash
    # cd CreditCard_E-statement/AFP_Conversion_Module_Design/ 
    # mvn clean package 
    # (This step is not strictly necessary to run the main method directly from an IDE if no external libs are used by main)
    ```

2.  **Run the `main` method in `AfpConversionService.java`:**
    *   **From an IDE:** Right-click on `AfpConversionService.java` and select "Run 'AfpConversionService.main()'".
    *   **From Command Line (after compiling with Maven, assuming you built a JAR - this is more complex due to dependencies like slf4j not being shaded by default):**
        A simpler way without full Maven assembly for this specific non-Spring main method:
        ```bash
        # Ensure you are in the 'CreditCard_E-statement/AFP_Conversion_Module_Design' directory
        # Compile the Java files (if no pom.xml is used for this simple main execution)
        # mkdir -p target/classes
        # javac -d target/classes -cp "src/main/java" src/main/java/com/example/afpconversion/model/*.java src/main/java/com/example/afpconversion/*.java

        # Run the main method
        # java -cp "target/classes" com.example.afpconversion.AfpConversionService 
        ```
        For simplicity, running from the IDE is recommended for this demonstration. The `main` method will print the outcome of the conversion.

    The output PDF will be created in the `AFP_Conversion_Module_Design/output/` directory (e.g., `output/statement.pdf`).

## Unit Tests
Unit tests can be run using Maven:
```bash
# cd CreditCard_E-statement/AFP_Conversion_Module_Design/ 
mvn test
```
This will execute tests like `AfpConversionServiceTest`, which uses a temporary directory for test files and validates the script execution logic.

---
**Note:** `run_conversion_tool.sh.example` is a **dummy script**. It does not perform real AFP conversion but simulates the process by creating a placeholder output file. For actual AFP conversion, this script would need to be replaced with calls to a real conversion engine.
